<div class="dashboard-container">
  <header class="dashboard-header">
    <div class="header-content">
      <div>
        <h1>Dashboard</h1>
        <div class="connection-status" [class.connected]="isConnected">
          <span class="status-dot"></span>
          <span class="status-text">Real-time Updates</span>
          <span class="last-update">Last update: {{ getFormattedTime() }}</span>
        </div>
      </div>
      <div class="user-info">
        <span class="welcome-text">Welcome, {{ currentUser?.name || currentUser?.email }}</span>
        <button class="btn-reports" routerLink="/reports">ğŸ“Š Reports</button>
        <button class="btn-comparisons" routerLink="/comparisons">ğŸ“ˆ Comparisons</button>
        <button class="btn-logout" (click)="logout()">Logout</button>
      </div>
    </div>
  </header>

  <main class="dashboard-main">
    <!-- Sensor Data Management -->
    <section class="sensor-form-section">
      <div class="form-header">
        <h2 class="section-title">ğŸ“¡ Sensor Data Management</h2>
        <button class="btn-toggle-form" (click)="toggleSensorForm()">
          â• Add Sensor Data
        </button>
      </div>
    </section>

    <!-- Create Dialog -->
    <div class="dialog-overlay" *ngIf="showCreateDialog" (click)="closeCreateDialog()">
      <div class="dialog-container" (click)="$event.stopPropagation()">
        <div class="dialog-header">
          <h2>ğŸ“¡ Add New Sensor Data</h2>
          <button class="dialog-close" (click)="closeCreateDialog()">Ã—</button>
        </div>
        
        <div class="dialog-body">
          <div class="sensor-form-container">
            <button class="btn-open-form" *ngIf="!showSensorForm" (click)="openFormInDialog()">
              ğŸ“ Fill Form
            </button>
            
            <form [formGroup]="sensorForm" (ngSubmit)="onSubmitSensorData()" class="sensor-form" *ngIf="showSensorForm">
              <div class="form-row">
                <div class="form-group">
                  <label for="sensorId">Sensor ID *</label>
                  <input 
                    type="text" 
                    id="sensorId" 
                    formControlName="sensorId" 
                    placeholder="e.g., sensor_001"
                    [class.error]="formSubmitted && sensorForm.get('sensorId')?.invalid"
                  />
                  <span class="error-message" *ngIf="formSubmitted && sensorForm.get('sensorId')?.invalid">
                    {{ getFieldError('sensorId') }}
                  </span>
                </div>

                <div class="form-group">
                  <label for="sensorType">Sensor Type *</label>
                  <select 
                    id="sensorType" 
                    formControlName="sensorType"
                    [class.error]="formSubmitted && sensorForm.get('sensorType')?.invalid"
                  >
                    <option value="">Select Type</option>
                    <option *ngFor="let type of sensorTypes" [value]="type">{{ type | titlecase }}</option>
                  </select>
                  <span class="error-message" *ngIf="formSubmitted && sensorForm.get('sensorType')?.invalid">
                    {{ getFieldError('sensorType') }}
                  </span>
                </div>
              </div>

              <div class="form-row">
                <div class="form-group">
                  <label for="value">Value *</label>
                  <input 
                    type="number" 
                    id="value" 
                    formControlName="value" 
                    placeholder="e.g., 25.5"
                    step="0.01"
                    [class.error]="formSubmitted && sensorForm.get('value')?.invalid"
                  />
                  <span class="error-message" *ngIf="formSubmitted && sensorForm.get('value')?.invalid">
                    {{ getFieldError('value') }}
                  </span>
                </div>

                <div class="form-group">
                  <label for="location">Location *</label>
                  <select 
                    id="location" 
                    formControlName="location"
                    [class.error]="formSubmitted && sensorForm.get('location')?.invalid"
                  >
                    <option value="">Select Location</option>
                    <option *ngFor="let loc of locations" [value]="loc">{{ loc }}</option>
                  </select>
                  <span class="error-message" *ngIf="formSubmitted && sensorForm.get('location')?.invalid">
                    {{ getFieldError('location') }}
                  </span>
                </div>
              </div>

              <div class="form-messages">
                <div class="success-message" *ngIf="formSuccess">
                  âœ… Sensor data sent successfully!
                </div>
                <div class="error-message" *ngIf="formError">
                  âš ï¸ {{ formError }}
                </div>
              </div>

              <div class="form-actions">
                <button type="submit" class="btn-submit" [disabled]="formSubmitted && sensorForm.invalid">
                  ğŸ“¤ Send Sensor Data
                </button>
                <button type="button" class="btn-cancel" (click)="closeCreateDialog()">Cancel</button>
              </div>
            </form>
          </div>
        </div>
      </div>
    </div>

    <section class="stats-section">
      <h2 class="section-title">ğŸ“Š Real-time Statistics</h2>
      <div class="stats-grid">
        <div class="stat-card" *ngFor="let stat of stats" [style.border-top-color]="stat.color">
          <div class="stat-icon" [style.background]="stat.color + '20'">
            <span>{{ stat.icon }}</span>
          </div>
          <div class="stat-content">
            <h3>{{ stat.title }}</h3>
            <p class="stat-value">{{ stat.value }}</p>
            <div class="stat-trend">
              <span class="trend-up">â†—</span>
              <span class="trend-text">Live</span>
            </div>
          </div>
        </div>
      </div>
    </section>

    <section class="activities-section">
      <h2 class="section-title">ğŸ• Recent Activities</h2>
      <div class="activities-list">
        <div class="activity-item" *ngFor="let activity of recentActivities">
          <div class="activity-icon" [class]="'icon-' + activity.type">
            <span *ngIf="activity.type === 'sensor'">ğŸ“¡</span>
            <span *ngIf="activity.type === 'traffic'">ğŸš¦</span>
            <span *ngIf="activity.type === 'pollution'">ğŸ­</span>
            <span *ngIf="activity.type === 'weather'">ğŸŒ§ï¸</span>
            <span *ngIf="activity.type === 'system'">âš¡</span>
          </div>
          <div class="activity-content">
            <p class="activity-action">{{ activity.action }}</p>
            <span class="activity-time">{{ activity.time }}</span>
          </div>
        </div>
      </div>
    </section>

    <section class="welcome-section">
      <div class="welcome-card">
        <h2>Welcome to Dashboard!</h2>
        <p>This is a simple dashboard that you can customize and add more features according to your needs.</p>
        <div class="welcome-actions">
          <button class="btn-primary" routerLink="/reports">ğŸ“Š View Reports</button>
          <button class="btn-primary" routerLink="/comparisons">ğŸ“ˆ Day to Day Comparisons</button>
          <button class="btn-secondary">Learn More</button>
        </div>
      </div>
    </section>
  </main>
</div>

